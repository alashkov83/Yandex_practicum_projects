# Проект «Промышленность»

## Стек: Python, Numpy, SciPy, Pandas, Scikit-learn, LightGBM, Matplotlib, Seaborn

## Описание проекта

### Задача

Чтобы оптимизировать производственные расходы, металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали. Вам предстоит построить модель, которая предскажет температуру стали.

### Описание этапа обработки

Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша.  
Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).  
Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.  
Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (англ. *slab*, «плита»).

## План работы

1. **Исследовательский анализ и исправление данных отдельных таблиц.** В качестве инструментов анализа использовать графики (гистограммы, ящик с усами, диаграммы рассеяния) и статисические методы (описательная статистика, корреляции). Затем необходимо удалить выбросы и исправить ошибки в данных.
2. **Отбор и конструирование признаков.** Для этого необходимо ввести новые переменные в отдельные таблицы. Удалить лишние на мой взгляд. Оставить только начальные и конечные значения температур. Длаее необходимо свести все данные из таблиц в отдельную таблицу и исключить строки, в которых отсутствует целевое значение. Проверить данные на мультиколинеарность. В данных нет категориальных переменных поэтому этап кодирования не нужен.
3. **Обучение моделей.** Перед обучением необходимо разделить данные на тестовую и обучающую выборки. Затем построить базовую линию. Обучить и рассмотреть методом cross-validation несколько моделей с подбором оптимальных гиперпараметров. Как минимум следует рассмотреть модели на деревьях и линейные модели. Определить лучшую модель.
4. **Тестирование лучшей модели на тестовом наборе c проверкой адекватности модели**

## Выводы

1. Данные, предоставленные заказчиком, были предварительно исследованы и обработаны. В некоторых таблицах присутствовали пропуски и выбросы, однако у них разные причины появления и соответственно разные механизмы устранения. В таблицах по объёму и времени добавления добавок пропуски обусловлены тем, что не все добавки используются для выплавки разных типов сталей, поэтому в таблицах объёмов пропуски были заменены на 0. В остальных таблицах строки с пропусками данных удалены.
2. Выбросы присутствовали в датасете, однако потребовалось их тщательное изучение. Те выбросы которые нефизичны - отрицательная реактивная мощность (1 значения), температура меньше 1400 (3 значения) удалены из всего датасета, те которые принципиально возможны - удалены только из тренировочного набора, после разделения дастасета на выборки, ими являлись реактивная мощность больше 2.5, нетипично высокие объёмы газа и сыпучих добавок (1 и 12).
3. Ввиду асинхронности процессов, временные метки имеет были использованы фактически только для определения начальной и конечной температур стали. В тоже время некоторые части датасета с временем добавления добавок задействовать не удалось.
4. Созданы дополнительные переменные:

    - Суммарная, минимальная, максимальная, средняя энергия, как произведение времени на активную мощность
    - Максимальная, средняя, минимальная активная можность
    - Максимальная, средняя, минимальная реактивная можность
    - Количество циклов включения дуги

   вычленены из данных значимые признаки. Многие виды добавок используются редко - данные по ним исключены из датасета. В качестве физически значимых параметров были добавлены средняя, минимальная, максимальная и суммарная активная (тепловая) энергия. В тоже время при проверке корреляционной матрицы были исключены активные мощности и макимальная реактивная мощность.

5. Данные были объединены в одну таблицу, используя внутренее объединение по признаку "key", в соответствии с требованием заказчика. В итоговой таблице было 2239 строки, 1 таргет (конечная температура) и 22 независимых переменных:

    - стартовая температура;
    - число включений дуги;
    - cуммарная, минимальная, максимальная, средняя энергия (активная) по циклам запуска дуги;
    - средняя и минимальная реактивная мощность;
    - объём газа;
    - объёмы проволочных добавок 1 и 2;
    - объёмы сыпучих добавок 14, 6, 1, 12, 15, 3, 4, 11, 5, 10
6. Набор был разбит на 2 части: тестовую и тренировочную в соотношении 1:3.
7. Опробованы модели гребневой регрессии, метода опорных векторов и градиентного бустинга рещающих деревьев из пакета LigthGBM. Для всех моделей подобраны оптимальные наиболее значимые гиперпараметры. Выбор лучшей модели осуществлён при помощи метода кросс-валидации. Перед обученим независимые переменные были стандартизированы для моделей линейной регрессии и SVM.  
8. Лучшей моделью по метрики MAE признана модель градиентного бустинга решающих деревьев при следующих гиперпараметрах: No. leaves = 15, Learning Rate = 0.05. Значение MAE = 6.059 при кросс-валидации. Немного отстаёт метод опорных векторов с ядрои RBF и гиперпараметрами  C = 10.0, epsilon = 1.0.
9.  Лучшая модель проверена на тестовом наборе. Требуемое заказчиком значение метрики MAE достигнуто и составило 5.96. Модель адекватна в сравнении с Dummy моделью.
10. Самые важные факторы влияющие на конечную температуру (в скобках указаны коэффициенты знчимости посчитанные на модели градиентного бустинга): начальная температура (292), общая активная энергия (235), объёмы добавки Wire 1 (98) и газа (82).
11. Все пункты плана выполнены успешно.
